<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>aiMessage</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#007AFF">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.css">
  <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-web-links@0.11.0/lib/addon-web-links.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-webgl@0.18.0/lib/addon-webgl.js"></script>
</head>
<body>
  <div id="app">

    <!-- HOME VIEW: Two-column dashboard (default) -->
    <div id="home-view">
      <div class="dashboard-inner">
        <!-- Dashboard header: greeting only -->
        <div class="dashboard-header">
          <h1 class="dashboard-greeting" id="dashboard-greeting">Hi Max</h1>
        </div>

        <!-- Two-column dashboard body -->
        <div class="dashboard-columns">
          <!-- Left: Projects -->
          <div class="dashboard-col col-projects">
            <div class="dashboard-section-header">
              <span class="dashboard-section-label">Projects</span>
              <div class="section-header-right">
                <span id="project-count" class="section-header-count">0</span>
                <span class="section-header-sep"></span>
                <button id="add-project-btn" class="add-project-btn" title="New Project">+</button>
              </div>
            </div>
            <div id="dashboard-projects"></div>
          </div>
          <!-- Right: Recent sessions -->
          <div class="dashboard-col col-recent">
            <span class="dashboard-section-label">Recent</span>
            <div id="dashboard-recent"></div>
          </div>
        </div>
      </div>

      <!-- Unified floating pill: search + compose -->
      <div class="bottom-bar" id="bottom-bar">
        <svg class="bottom-bar-search-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
          <circle cx="7" cy="7" r="5.5" stroke="currentColor" stroke-width="1.5"/>
          <line x1="11" y1="11" x2="14" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <input type="text" id="home-search" placeholder="Search sessions..." autocomplete="off" />
        <button id="compose-fab" class="compose-btn-inner" title="New Session (⌘N)" aria-label="New Session">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 20h9"/>
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
          </svg>
        </button>
      </div>

      <!-- Hidden — kept for JS event binding -->
      <button id="new-session-btn" class="icon-btn compose-btn" aria-hidden="true" tabindex="-1" style="display:none"></button>

      <!-- Hidden legacy elements kept for JS compatibility -->
      <div id="session-list" style="display:none"></div>
      <div class="session-row new-session-active" id="new-session-row" style="display:none">
        <div class="session-row-unread hidden-dot">
          <span class="session-row-unread-dot"></span>
        </div>
        <div class="session-avatar" style="background: #8E8E93">
          <span class="avatar-initial">+</span>
        </div>
        <div class="session-row-body">
          <div class="session-row-top">
            <span class="session-row-name">New Session</span>
          </div>
        </div>
      </div>
    </div>

    <!-- SPLIT VIEW: Session header + Sidebar column + Terminal column -->
    <div id="split-view" class="hidden">
      <div class="session-inner">
        <div class="session-header">
          <button id="back-btn" title="Back to home">&#8249;</button>
          <span class="session-title" id="session-title">Sessions</span>
        </div>
        <div class="session-columns">
          <div id="sidebar">
            <div id="sidebar-list"></div>
            <div class="search-bar">
              <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="7" cy="7" r="5.5" stroke="currentColor" stroke-width="1.5"/>
                <line x1="11" y1="11" x2="14" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <input type="text" id="sidebar-search" placeholder="Search" autocomplete="off">
            </div>
          </div>
          <div id="conversation-area">
            <div id="new-session-config" class="hidden">
              <div class="config-bar">
                <label>Name:</label>
                <input type="text" id="config-name" placeholder="e.g. fix auth bug" autocomplete="off">
                <label>Project:</label>
                <select id="config-group"><option value="">None</option></select>
                <label>Dir:</label>
                <input type="text" id="config-dir" placeholder="~/projects/..." autocomplete="off">
              </div>
              <div class="config-message-area">
                <textarea id="config-message" placeholder="What should Claude work on?" rows="2"></textarea>
                <button id="config-start" class="start-btn">Start</button>
              </div>
            </div>
            <div id="panels-container"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Context menu for sessions -->
    <div id="context-menu" class="context-menu hidden">
      <button class="context-menu-item" data-action="rename">Rename</button>
      <button class="context-menu-item" data-action="pin">Pin</button>
      <button class="context-menu-item" data-action="assign-project">Move to Project</button>
      <hr class="context-menu-divider">
      <button class="context-menu-item" data-action="archive">Archive</button>
    </div>

    <!-- Project picker submenu -->
    <div id="project-picker" class="context-menu hidden">
      <!-- Populated dynamically -->
    </div>

    <!-- Context menu for projects -->
    <div id="project-context-menu" class="context-menu hidden">
      <button class="context-menu-item" data-action="rename-project">Rename</button>
      <hr class="context-menu-divider">
      <button class="context-menu-item danger" data-action="delete-project">Delete</button>
    </div>

  </div>

  <!-- Panel template (used by JS) -->
  <template id="panel-template">
    <div class="panel" data-session-id="">
      <div class="panel-header">
        <div class="panel-header-left">
          <span class="status-dot"></span>
          <span class="panel-name"></span>
          <span class="panel-group-label"></span>
        </div>
        <div class="panel-header-right">
          <span class="panel-dir"></span>
          <button class="panel-close-btn" title="Close panel">&times;</button>
        </div>
      </div>
      <div class="terminal-container"></div>
    </div>
  </template>

  <script src="app.js"></script>
</body>
</html>
